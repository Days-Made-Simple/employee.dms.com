<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Set New Password</title>
<style>
  *{box-sizing:border-box;margin:0;padding:0}
  html,body{height:100%}
  body{
    font-family: Inter, Roboto, -apple-system, "Segoe UI", "Helvetica Neue", Arial;
    background:#ffffff;
    color:#111827;
    -webkit-font-smoothing:antialiased;
    display:flex;
    align-items:center;
    justify-content:center;
    padding:24px;
  }
  .container{
    width:100%;
    max-width:420px;
    border-radius:12px;
    box-shadow:0 8px 30px rgba(17,24,39,0.06);
    overflow:hidden;
    background:#ffffff;
  }
  .header{
    padding:24px 28px;
    display:flex;
    align-items:center;
    gap:12px;
    border-bottom:1px solid rgba(15,23,42,0.04);
  }
  .logo{
    height:40px;
    width:40px;
    border-radius:6px;
    background:#eef2ff;
    display:flex;
    align-items:center;
    justify-content:center;
    font-weight:700;
    color:#4338ca;
    font-size:16px;
  }
  .brand { font-size:18px; font-weight:600; }
  .form{ padding:28px; }
  label{display:block;font-size:13px;margin-bottom:8px;color:#374151}
  input[type="password"]{
    width:100%;
    padding:12px 14px;
    border:1px solid rgba(15,23,42,0.08);
    border-radius:8px;
    font-size:15px;
    outline:none;
    background:#fff;
  }
  input[type="password"]:focus{box-shadow:0 0 0 4px rgba(99,102,241,0.06);border-color:#6366f1}
  .actions{margin-top:18px;display:flex;align-items:center;justify-content:flex-end}
  .btn{
    background:#6366f1;
    color:#fff;
    padding:10px 14px;
    border-radius:8px;
    border:none;
    font-weight:600;
    cursor:pointer;
  }
  .btn:hover{background:#4f46e5}
  .small-note{font-size:12px;color:#6b7280;margin-top:12px}
  .footer{
    padding:12px 20px;
    border-top:1px solid rgba(15,23,42,0.04);
    font-size:12px;
    color:#6b7280;
    text-align:center;
  }
</style>
</head>
<body>
<div class="container" role="main">
  <div class="header">
    <div class="logo">ID</div>
    <div>
      <div class="brand">Reset Your Password</div>
      <div style="font-size:12px;color:#6b7280">Enter your new password below</div>
    </div>
  </div>

  <form class="form" onsubmit="event.preventDefault();submitNewPassword()">
    <div>
      <label>New Password</label>
      <input type="password" id="newPassword" placeholder="Enter new password" required />
    </div>
    <div>
      <label>Confirm Password</label>
      <input type="password" id="confirmPassword" placeholder="Confirm password" required />
    </div>
    <div class="actions">
      <button class="btn" type="submit">Set Password</button>
    </div>
    <div id="message" class="small-note"></div>
  </form>

  <div class="footer">If you need help, contact your system administrator.</div>
</div>

<script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-auth-compat.js"></script>
<script>
  const firebaseConfig = {
    apiKey: "AIzaSyC6ReZ9JiKAhVwXLUwgzRRsk2Daw3pRli8",
    authDomain: "daysmadesimple-admin.firebaseapp.com",
    projectId: "daysmadesimple-admin",
    storageBucket: "daysmadesimple-admin.firebasestorage.app",
    messagingSenderId: "165327565681",
    appId: "1:165327565681:web:e28364ebb3cb1d9a683cd0"
  };
  firebase.initializeApp(firebaseConfig);
  const auth = firebase.auth();

  // Extract oobCode from URL query params
  const urlParams = new URLSearchParams(window.location.search);
  const oobCode = urlParams.get('oobCode');

  function submitNewPassword() {
    const newPassword = document.getElementById('newPassword').value.trim();
    const confirmPassword = document.getElementById('confirmPassword').value.trim();
    const messageEl = document.getElementById('message');

    if(newPassword !== confirmPassword){
      messageEl.textContent = "❌ Passwords do not match.";
      return;
    }

    if(!oobCode){
      messageEl.textContent = "❌ Invalid or missing reset code.";
      return;
    }

    // Verify the code and apply the new password
    auth.verifyPasswordResetCode(oobCode)
      .then(email => {
        return auth.confirmPasswordReset(oobCode, newPassword);
      })
      .then(() => {
        messageEl.textContent = "✅ Password has been reset successfully!";
        setTimeout(()=>{ window.location.href = '/'; }, 3000);
      })
      .catch(err => {
        messageEl.textContent = "❌ "+err.message;
      });
  }
</script>
</body>
</html>
